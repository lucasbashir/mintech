{% load custom_tags %}
{% load my_filters %}
{% load static %}

<div class="img-fluid react_space" id="react_space">
    <div class="reaction-button" id="reaction-buttons-{{ posts.id }}">
      {% if user.is_authenticated %}
        {% if request.user in posts.group_user_like.all %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='like' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="unlikePost" value="{{ posts.id }}" />
            <button>
              <i class="fa fa-thumbs-down"></i> Unlike
            </button>
          </form>
        {% else %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='like' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="likePost" value="{{ posts.id }}"/>
            <button style="background: none; border: none;">
              <img src="/media/post_image/hand.gif" class="rounded-circle" width="50" height="50" alt="Maa Shaa Allah"/>
            </button>
          </form>
        {% endif %}
  
        {% if request.user in posts.group_userLove.all %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='love' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="unlikePost" value="{{ posts.id }}" />
            <button>
              <i class="fa fa-thumbs-down"></i> Unlike
            </button>
          </form>
        {% else %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='love' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="likePost" value="{{ posts.id }}" />
            <button style="background: none; border: none;">
              <img src="/media/post_image/mashaa.gif" class="rounded-circle" width="50" height="50" alt="Maa Shaa Allah"/>
            </button>
          </form>
        {% endif %}
  
        {% if request.user in posts.group_userSad.all %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='sad' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="unlike_sad" value="{{ posts.id }}" />
            <button>
              <i class="fa fa-thumbs-down"></i> Unlike
            </button>
          </form>
        {% else %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='sad' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="likePost" value="{{ posts.id }}" />
            <button style="background: none; border: none;">
              <img src="/media/post_image/allah.gif" width="50" height="50" alt="Allah akbar"/>
            </button>
          </form>
        {% endif %}
  
        {% if request.user in posts.group_userHaha.all %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='haha' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="unlikePost" value="{{ posts.id }}" />
            <button>
              <i class="fa fa-thumbs-down"></i> Unlike
            </button>
          </form>
        {% else %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='haha' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="likePost" value="{{ posts.id }}" />
            <button style="background: none; border: none;">
              <img src="/media/post_image/funny.gif" class="rounded-circle" width="50" height="50" alt="Maa Shaa Allah"/>
            </button>
          </form>
        {% endif %}
  
        {% if request.user in posts.group_userShock.all %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='shock' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="unlike_shock" value="{{ posts.id }}" />
            <button>
              <i class="fa fa-thumbs-down"></i> Unlike
            </button>
          </form>
        {% else %}
          <form action="{% url 'group_add_or_remove_reaction' post_id=posts.id reaction_type='shock' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="shockPost" value="{{ posts.id }}" />
            <button style="background: none; border: none;">
              <img src="/media/post_image/shock.gif" class="rounded-circle" width="50" height="50" alt="Subhanallah"/>
            </button>
          </form>
        {% endif %}
      {% endif %}
    </div>
  
  <h3 class="like-btn" data-post-id="{{ posts.id }}"><i class="fa fa-thumbs-up"></i></h3>

  {% with total_count=posts.group_postLove.count|add:posts.group_postHaha.count|add:posts.group_postSad.count|add:posts.group_postShock.count|add:posts.group_post_like.count %}
  {% if posts.group_post_like.count > 0 and posts.group_postHaha.count < 1 and posts.group_postSad.count < 1 and posts.group_postLove.count < 1 and posts.group_postShock.count < 1 %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">👍 {{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_post_like.count < 1 and posts.group_postHaha.count < 1 and posts.group_postSad.count < 1 and posts.group_postLove.count > 0 and posts.group_postShock.count < 1 %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">❤️ {{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_post_like.count < 1 and posts.group_postHaha.count < 1 and posts.group_postSad.count > 0 and posts.group_postLove.count < 1 and posts.group_postShock.count < 1 %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">😢 {{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_post_like.count < 1 and posts.group_postHaha.count > 0 and posts.group_postSad.count < 1 and posts.group_postLove.count < 1 and posts.group_postShock.count < 1 %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">😂{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_post_like.count < 1 and posts.group_postHaha.count < 1 and posts.group_postSad.count < 1 and posts.group_postLove.count < 1 and posts.group_postShock.count > 0 %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">😲{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_post_like.count > 0 and posts.group_postHaha.count < 1 and posts.group_postSad.count > 0 and posts.group_postLove.count < 1 and posts.group_postShock.count < 1 %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">👍😢{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_post_like.count > 0 and posts.group_postHaha.count > 0 and posts.group_postSad.count < 1 and posts.group_postLove.count < 1 and posts.group_postShock.count < 1 %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">👍😂{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_postLove.count > 0 and posts.group_postHaha.count > 0 and posts.group_postShock.count > 0 and posts.group_post_like.count > 0 and posts.group_postSad.count < 1%}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">👍❤️😂😮{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_postLove.count > 0 and posts.group_postHaha.count < 1 and posts.group_postShock.count < 1 and posts.group_post_like.count > 0 and posts.group_postSad.count < 1%}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">👍❤️{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% elif posts.group_postLove.count > 0 and posts.group_postHaha.count > 0 and posts.group_postShock.count > 0 and posts.group_post_like.count > 0 and posts.group_postSad.count > 0%}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">👍❤️😂😮😢{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% else %}
      <h3 onclick="opensModal('{{ posts.id }}')"><button class="like-button">👍{{ total_count }}</button> 💬 {{ posts.group_comment.count }}</h3>
  {% endif %}
{% endwith %}


  <!-- Modal -->
  <div id="reactedUsersModal-{{ posts.id }}" class="reaction-modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close" onclick="closesModal('{{ posts.id }}')">&times;</span>
      <div class="reaction-columns">
        <div class="reaction-column">
          <p class="desktop-only">Like</p>
          <button onclick="showColumn('like-column-{{ posts.id }}')" style="background: none; border: none;">
            <img src="/media/post_image/hand.gif" class="rounded-circle" width="30" height="30" alt="Maa Shaa Allah"/>{{posts.group_user_like.count}}
          </button>
          <div id="like-column-{{ posts.id }}">
            {% for like_reactions in posts.group_user_like.all %}
              <a href="{% url 'profile' user_id=like_reactions.user.id %}">{{ like_reactions.user }}</a><br>
            {% endfor %}
          </div>
        </div>
        <div class="reaction-column">
          <p class="desktop-only">Maa Shaa Allah</p>
          <button onclick="showColumn('love-column-{{ posts.id }}')" style="background: none; border: none;">
            <img src="/media/post_image/mashaa.gif" class="rounded-circle" width="30" height="30" alt="Maa Shaa Allah"/>{{posts.group_userLove.count}}
          </button>

          <div id="love-column-{{ posts.id }}">
            {% for love_reactions in posts.group_userLove.all %}
              <a href="{% url 'profile' user_id=love_reactions.user.id %}">{{ love_reactions.user }}</a><br>
            {% endfor %}
          </div>
        </div>
        <div class="reaction-column">
          <p class="desktop-only">Subhanallah</p>
          <button onclick="showColumn('shock-column-{{ posts.id }}')" style="background: none; border: none;">
            <img src="/media/post_image/shock.gif" class="rounded-circle" width="30" height="30" alt="Subhanallah"/>{{posts.group_userShock.count}}
          </button>

        <div id="shock-column-{{ posts.id }}">
          {% for shock_reactions in posts.group_userShock.all %}
            <a href="{% url 'profile' user_id=shock_reactions.user.id %}">{{ shock_reactions.user }}</a><br>
          {% endfor %}
        </div>
      </div>
      <div class="reaction-column">
        <p class="desktop-only">Haha</p>
        <button onclick="showColumn('haha-column-{{ posts.id }}')" style="background: none; border: none;">
          <img src="/media/post_image/funny.gif" class="rounded-circle" width="30" height="30" alt="Maa Shaa Allah"/>{{posts.group_userHaha.count}}
        </button>

        <div id="haha-column-{{ posts.id }}">
          {% for haha_reactions in posts.group_userHaha.all %}
            <a href="{% url 'profile' user_id=haha_reactions.user.id %}">{{ haha_reactions.user }}</a><br>
          {% endfor %}
        </div>
      </div>
      <div class="reaction-column">
        <p class="desktop-only">Sad</p>
        <button onclick="showColumn('sad-column-{{ posts.id }}')" style="background: none; border: none;">
          <img src="/media/post_image/allah.gif" class="rounded-circle" width="30" height="30" alt="Allah akbar"/>{{posts.group_userSad.count}}
        </button>

        <div id="sad-column-{{ posts.id }}">
          {% for sad_reactions in posts.group_userSad.all %}
            <a href="{% url 'profile' user_id=sad_reactions.user.id %}">{{ sad_reactions.user }}</a><br>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
